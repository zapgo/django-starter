db_data:
  image: postgres
  command: echo "DB data volume!"
  volumes:
    - /var/lib/postgresql/data

postgres:
  image: postgres
#  volumes_from:
#    - db_data
  env_file:
    - ${PWD}/.env

redis:
  image: redis

rabbitmq:
  image: rabbitmq:3-management
  ports:
    - "5672:5672"
    - "15672:15672"
  env_file:
    - ${PWD}/.env

webapp:
  image: ${IMAGE_NAME}
#  build: ${PWD}
#  ports:
#    - "8000:8000"
#  command: /docker-entrypoint.sh gunicorn
#  links:
#    - postgres:db
#    - rabbitmq:rabbit-node
#    - redis:redis
  user: webapp
  volumes:
    - ${PWD}/src:/app
  env_file: ${PWD}/.env
  log_opt:
    max-size: "500k"
    max-file: "2"


nginx-proxy:
  image: jwilder/nginx-proxy
  ports:
    - 80:80
    - 443:443
  volumes:
    - /srv/htdocs:/var/www:ro
    - /srv/certs:/etc/nginx/certs:ro
    - /srv/config/:/etc/nginx/vhost.d:ro
    - /var/run/docker.sock:/tmp/docker.sock:ro
